CREATE DATABASE IF NOT EXISTS repair_system;
USE repair_system;

-- users table
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    password VARCHAR(255),
    role ENUM('admin', 'user') DEFAULT 'user',
    allowed_pages TEXT DEFAULT NULL
);

-- เพิ่มผู้ใช้ admin เริ่มต้น
INSERT INTO users (username, password, role)
VALUES ('admin', '$2y$10$RmVMFis7ZN03s2J3Rcmu/egwKqDFWIY95PQbQU6a69Yp.JPvVf6FK', 'admin');

-- repairs table
CREATE TABLE repairs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    case_number VARCHAR(20) NOT NULL UNIQUE,
    target ENUM('A', 'B') NOT NULL,
    branch_prefix ENUM('bbq', 'suki') NOT NULL,
    branch VARCHAR(100),
    title VARCHAR(255),
    description TEXT,
    reporter VARCHAR(100),
    contact VARCHAR(20),
    image1 VARCHAR(255),
    image2 VARCHAR(255),
    image3 VARCHAR(255),
    note TEXT DEFAULT NULL,
    status ENUM('แจ้งซ่อม', 'กำลังดำเนินการ', 'เสร็จสิ้น') DEFAULT 'แจ้งซ่อม',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE repairs ADD COLUMN deleted TINYINT(1) DEFAULT 0;


-- repair_history table
CREATE TABLE repair_history (
    id INT AUTO_INCREMENT PRIMARY KEY,
    repair_id INT NOT NULL,
    action TEXT,
    updated_by VARCHAR(50),
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (repair_id) REFERENCES repairs(id) ON DELETE CASCADE
);

-- DATA FOR TEST
INSERT INTO repairs (case_number, target, branch_prefix, branch, title, description, reporter, contact, image1, image2, image3, note, status)
VALUES
('20250609-1', 'A', 'bbq', 'สาขาสยาม', 'เครื่องชำรุด', 'เครื่อง BBQ ไม่ทำงาน', 'สมชาย', '0812345678', NULL, NULL, NULL, 'แจ้งครั้งแรก', 'แจ้งซ่อม'),
('20250609-2', 'B', 'suki', 'สาขาอโศก', 'น้ำรั่ว', 'น้ำรั่วที่ซิงค์', 'สมหญิง', '0898765432', NULL, NULL, NULL, '', 'กำลังดำเนินการ'),
('20250609-3', 'A', 'bbq', 'สาขาเซ็นทรัล', 'แอร์เสีย', 'แอร์เย็นไม่ออก', 'มนตรี', '0801234567', NULL, NULL, NULL, 'รอตรวจสอบ', 'แจ้งซ่อม'),
('20250609-4', 'B', 'suki', 'สาขาแฟชั่น', 'ไฟฟ้าขัดข้อง', 'ไฟฟ้าดับบางจุด', 'ปาน', '0876543210', NULL, NULL, NULL, 'แจ้งด่วน', 'กำลังดำเนินการ'),
('20250609-5', 'A', 'bbq', 'สาขาเอ็มโพเรียม', 'เตาไม่ติด', 'เตา BBQ จุดไม่ติด', 'จิตร', '0861234567', NULL, NULL, NULL, '', 'เสร็จสิ้น'),
('20250609-6', 'B', 'suki', 'สาขาเซ็นทรัลลาดพร้าว', 'เครื่องซักผ้าชำรุด', 'เครื่องซักผ้าไม่หมุน', 'กมล', '0845678910', NULL, NULL, NULL, 'ซ่อมเสร็จแล้ว', 'เสร็จสิ้น'),
('20250609-7', 'A', 'bbq', 'สาขารัชดา', 'น้ำไม่ไหล', 'น้ำประปาไม่ไหล', 'วิชัย', '0823456789', NULL, NULL, NULL, 'รอช่าง', 'แจ้งซ่อม'),
('20250609-8', 'B', 'suki', 'สาขาสีลม', 'ประตูชำรุด', 'ประตูไม่ปิด', 'สุนิตย์', '0834567890', NULL, NULL, NULL, '', 'กำลังดำเนินการ'),
('20250609-9', 'A', 'bbq', 'สาขาสาทร', 'กล้องวงจรปิดเสีย', 'กล้องวงจรปิดไม่ทำงาน', 'เกษม', '0856789012', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-10', 'B', 'suki', 'สาขาอโศก', 'เครื่องกรองน้ำเสีย', 'เครื่องกรองน้ำรั่ว', 'อร', '0810987654', NULL, NULL, NULL, 'เปลี่ยนอะไหล่แล้ว', 'เสร็จสิ้น'),
('20250609-11', 'A', 'bbq', 'สาขาพารากอน', 'เตาแก๊สเสีย', 'เตาแก๊สจุดไม่ติด', 'สมชาย', '0811111111', NULL, NULL, NULL, 'รออะไหล่', 'แจ้งซ่อม'),
('20250609-12', 'B', 'suki', 'สาขาเอ็มบีเค', 'น้ำไม่ร้อน', 'เครื่องทำน้ำร้อนไม่ทำงาน', 'สมหญิง', '0822222222', NULL, NULL, NULL, '', 'กำลังดำเนินการ'),
('20250609-13', 'A', 'bbq', 'สาขาเซ็นทรัลเวิลด์', 'ไฟดับบางจุด', 'ไฟฟ้าขัดข้องในห้องครัว', 'มนตรี', '0833333333', NULL, NULL, NULL, 'กำลังซ่อม', 'กำลังดำเนินการ'),
('20250609-14', 'B', 'suki', 'สาขาเซ็นทรัลปิ่นเกล้า', 'แอร์เสีย', 'แอร์ไม่เย็น', 'ปาน', '0844444444', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-15', 'A', 'bbq', 'สาขาเซ็นทรัลลาดพร้าว', 'เครื่องปิ้งเสีย', 'เครื่องปิ้งทำงานผิดปกติ', 'จิตร', '0855555555', NULL, NULL, NULL, 'ตรวจสอบ', 'กำลังดำเนินการ'),
('20250609-16', 'B', 'suki', 'สาขารัชโยธิน', 'กล้องวงจรปิดชำรุด', 'กล้องวงจรปิดไม่บันทึกภาพ', 'กมล', '0866666666', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-17', 'A', 'bbq', 'สาขาอโศก', 'เครื่องซักผ้าเสีย', 'เครื่องซักผ้าไม่ทำงาน', 'วิชัย', '0877777777', NULL, NULL, NULL, 'รออะไหล่', 'กำลังดำเนินการ'),
('20250609-18', 'B', 'suki', 'สาขาอโศก', 'ประตูอัตโนมัติไม่เปิด', 'ประตูไฟฟ้าไม่ตอบสนอง', 'สุนิตย์', '0888888888', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-19', 'A', 'bbq', 'สาขาสีลม', 'น้ำประปาไหลช้า', 'น้ำประปาไหลไม่แรง', 'เกษม', '0899999999', NULL, NULL, NULL, '', 'เสร็จสิ้น'),
('20250609-20', 'B', 'suki', 'สาขาราชเทวี', 'เครื่องกรองน้ำเสีย', 'เครื่องกรองน้ำรั่ว', 'อร', '0800000000', NULL, NULL, NULL, 'ซ่อมเสร็จแล้ว', 'เสร็จสิ้น'),
('20250609-21', 'A', 'bbq', 'สาขาบางนา', 'เตาแก๊สหมดแก๊ส', 'เตาแก๊สไม่ทำงานเพราะแก๊สหมด', 'สมชาย', '0811234567', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-22', 'B', 'suki', 'สาขาเซ็นทรัลแจ้งวัฒนะ', 'แอร์ไม่เย็น', 'แอร์ไม่ทำงานตามปกติ', 'สมหญิง', '0822345678', NULL, NULL, NULL, '', 'กำลังดำเนินการ'),
('20250609-23', 'A', 'bbq', 'สาขาเดอะมอลล์บางกะปิ', 'ไฟฟ้าดับ', 'ไฟฟ้าดับบางโซน', 'มนตรี', '0833456789', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-24', 'B', 'suki', 'สาขาเซ็นทรัลรัตนาธิเบศร์', 'น้ำรั่ว', 'น้ำรั่วที่ท่อหลัก', 'ปาน', '0844567890', NULL, NULL, NULL, '', 'กำลังดำเนินการ'),
('20250609-25', 'A', 'bbq', 'สาขาเซ็นทรัลพระราม 3', 'เครื่องปิ้งเสีย', 'เครื่องปิ้งไม่ทำงาน', 'จิตร', '0855678901', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-26', 'B', 'suki', 'สาขาเซ็นทรัลพระราม 2', 'กล้องวงจรปิดเสีย', 'กล้องไม่บันทึกภาพ', 'กมล', '0866789012', NULL, NULL, NULL, '', 'เสร็จสิ้น'),
('20250609-27', 'A', 'bbq', 'สาขาเซ็นทรัลอีสต์วิลล์', 'เครื่องซักผ้าเสีย', 'เครื่องซักผ้าไม่ทำงาน', 'วิชัย', '0877890123', NULL, NULL, NULL, '', 'กำลังดำเนินการ'),
('20250609-28', 'B', 'suki', 'สาขาพาราไดซ์พาร์ค', 'ประตูอัตโนมัติชำรุด', 'ประตูเปิดไม่ออก', 'สุนิตย์', '0888901234', NULL, NULL, NULL, '', 'แจ้งซ่อม'),
('20250609-29', 'A', 'bbq', 'สาขาเซ็นทรัลเวสต์เกต', 'น้ำไม่ไหล', 'น้ำประปาไม่ไหล', 'เกษม', '0899012345', NULL, NULL, NULL, '', 'เสร็จสิ้น'),
('20250609-30', 'B', 'suki', 'สาขาเซ็นทรัลลาดกระบัง', 'เครื่องกรองน้ำเสีย', 'เครื่องกรองน้ำไม่ทำงาน', 'อร', '0801234567', NULL, NULL, NULL, '', 'กำลังดำเนินการ');
